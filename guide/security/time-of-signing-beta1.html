<!--[Targeted for programmers.]-->
<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <title>Signature Time Stamp Support in J2SE 5.0
   </title>
</head>
<body bgcolor="#FFFFFF">

<h1>

<hr SIZE=3 NOSHADE WIDTH="100%"></h1>

<center>
<h1>
Signature Timestamp Support
<br>
for J2SE 5.0
</h1></center>

<hr SIZE=3 NOSHADE WIDTH="100%">

<p>
<strong>IMPORTANT NOTE:</strong> The APIs and features described in this 
document are SUBJECT TO CHANGE.
<p>

<a name=INTRO><h2>Introduction</h2></a>
This document describes the enhancements that have been added in J2SE
5.0 to support signature timestamps.
Please send feedback, especially those related to these new features, to
<a href=mailto:java-security@sun.com>java-security@sun.com</a>.

<p>
Prior to J2SE 5.0, the signature generated by 
<code>jarsigner</code> contained no information about w
hen the signature was generated. With no other
information available, systems/deployers (including users of the Java
Plug-in) often based their validity assessment of a signed JAR file on
the validity of the signing certificate. When the signing certificate
expires, systems/deployers conclude that the signature, and hence, the
JAR file, has expired. Because signing certificates typically expire
annually, this caused customers significant problems by forcing them
to re-sign deployed JAR files annually.
<p>
Starting in J2SE 5.0, <code>jarsigner</code> can generate signatures that include a
timestamp, thus enabling systems/deployer (including Java Plug-in) to
check whether the JAR file was signed while the signing certificate was
still valid. In addition, APIs were added in J2SE 5.0 to allow applications
to obtain the timestamp information.
<p>
The following time-of-signing enhancements and additions are supported in 
version 5.0 of the Java 2 platform:
<ul>
<li><a href=#JARSIGNER>Jarsigner Enhancements</a>
<li><a href=#JAVAPLUGIN>Java Plug-in Enhancements</a>
<li><a href=#APIENHANCE>API Enhancements</a>
</ul>

<p>

<a name=JARSIGNER><h2>Jarsigner Enhancements</h2></a>
The <code>jarsigner</code> tool can now generate and store a signature timestamp 
when signing a JAR file. In addition, <code>jarsigner</code> supports alternative
signing mechanisms. This behavior is optional and is controlled by 
the user at the time of signing through the options described below.

<h3>Jarsigner Timestamp Options</h3>
The following options were added to the <code>jarsigner</code> tool to support signature
timestamps:
<p>
<code>-tsa url</code>
<blockquote>
If <code>"-tsa http://example.tsa.url"</code> appears on the command line when 
signing a JAR file then a timestamp is generated for the signature. The URL,
<code>http://example.tsa.url</code>, identifies the location of the Time Stamping 
Authority (TSA). It overrides any URL found via the <code>-tsacert</code>
option. The <code>-tsa</code> option does not require the 
TSA's public key certificate to be present in the keystore.
<p> 
To generate the timestamp, <code>jarsigner</code> communicates with the TSA 
using the Time-Stamp Protocol (TSP) defined in 
<a href=http://www.ietf.org/rfc/rfc3161.txt>RFC 3161</a>. 
If successful, the timestamp token returned by the TSA is stored along with 
the signature in the signature block file.
</blockquote>
<p>
<code>-tsacert alias</code>
<blockquote>
If <code>"-tsacert alias"</code> appears on the command line when signing a 
JAR file then a timestamp is generated for the signature.  The <code>alias</code> 
identifies the TSA's public key certificate in the keystore that is currently in 
effect. The entry's certificate is examined for a Subject Information Access 
extension that contains a URL identifying the location of the TSA. 
<p>
The TSA's public key certificate must be present in the keystore when using 
<code>-tsacert</code>.
</blockquote>

<h3>Alternative Signing Options</h3>

<h4>Specifying an Alternative Signing Mechanism</h4>

<code>-altsigner  class</code>

<blockquote> 
Specifies that an alternative signing mechanism be used. The fully-qualified
class name identifies a class file that extends the
<code>com.sun.jarsigner.ContentSigner abstract class</code>. The path to this 
class file is defined by the <code>-altsignerpath</code> option. If the 
<code>-altsigner</code> option is used, <code>jarsigner</code> uses the signing 
mechanism provided by the specified class. 
Otherwise, <code>jarsigner</code> uses its default signing mechanism.
<p>
For example, to use the signing mechanism provided by a class named
<code>com.sun.sun.jarsigner.AuthSigner</code>, use the <code>jarsigner</code> 
option <code>"-altsigner com.sun.jarsigner.AuthSigner"</code>
</blockquote>

<h4>Specifying Path to Alternative Signing Mechanism</h4>

<code>-altsignerpath  classpathlist</code>

<blockquote> 
Specifies the path to the class file (the class file name is specified with 
the <code>-altsigner</code> option described above) and any JAR files it 
depends on. If the class file is in a JAR file, 
then this specifies the path to that JAR file, as shown in the example below.
<p>
An absolute path or a path relative to the current directory may be
specified. If <code>classpathlist</code> contains multiple paths or JAR files, 
they should be separated with a colon (<code>:</code>) on Solaris and a 
semi-colon (<code>;</code>) on Windows. This option is not necessary if the 
class is already in the search path.
<p> 
Example of specifying the path to a jar file that contains the class file:
<p>
<code>-altsignerpath /home/user/lib/authsigner.jar</code>
<p>
Note that the JAR file name is included.
<p>
Example of specifying the path to the jar file that contains the class file:
<p>
<code>-altsignerpath /home/user/classes/com/sun/tools/jarsigner/</code>
<p>
Note that the JAR file name is omitted.
</blockquote>

<a name=JAVAPLUGIN><h2>Java Plug-in Enhancements</h2></a>
In J2SE 5.0, the Java Plug-in was enhanced to check signature timestamps
(if available) when validating  JAR files. The Java Plug-in will no
longer present a dialog when it encounters an expired or revoked
certificate when validating a signed jar, provided that the signature
timestamp confirms that the signature was generated prior to the
expiration or revocation date.
<p>
The TSA's certificate must be available from the Plug-in's 
keystore or certificate stores when the Plug-in is validating a JAR file 
containing a signature timestamp.
<p>
The Plugin reverts to 1.4.x behavior if the signature does not contain
a timestamp.
<p>

<a name=APIENHANCE><h2>API Enhancements</h2></a>
The security and JAR APIs were enhanced to enable applications to
access timestamp information.
<p>
Two new classes were added to the <tt>java.security</tt> package.
These classes
are <a href=../../api/java/security/CodeSigner.html>CodeSigner</a>, 
which maintains information associated with a signer, and 
<a href=../../api/java/security/Timestamp.html>Timestamp</a>,
which represents information associated with a signature timestamp.
<p>

New methods were added to the 
<tt><a href="../../api/java/security/CodeSource.html#getCodeSigners()">
java.security.CodeSource</a></tt>
class and
<tt><a href="../../api/java/util/jar/JarEntry.html#getCodeSigners()">
java.util.jar.JarEntry</a></tt>
class to allow access to this new, optional information.

<blockquote>
<hr>

<pre>



